# üöö –ü–ª–∞–Ω –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–µ–∑–¥–∞ –Ω–∞ backend (web + desktop)

## –¶–µ–ª—å

–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ Equipment Tracker —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ (Electron + SQLite/IPC) –Ω–∞ –µ–¥–∏–Ω—É—é backend-–º–æ–¥–µ–ª—å, –≥–¥–µ:

- backend —è–≤–ª—è–µ—Ç—Å—è **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã**;
- **web** –∏ **desktop** –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ API –∏ –æ–¥–Ω–∏ –¥–∞–Ω–Ω—ã–µ;
- IPC –≤ Electron –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –û–° (—Ç—Ä–µ–π, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, file dialogs, secure storage).

---

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

–°–µ–π—á–∞—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –æ—Ñ—Ñ–ª–∞–π–Ω-first:

- –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∂–∏–≤—É—Ç –≤ main-process Electron (`electron/ipc/*`, `electron/database.ts`);
- –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ SQLite;
- web-—Ä–µ–∂–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π desktop-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend (–µ–¥–∏–Ω—ã–π)

- –î–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã: `requests`, `equipment_items`, `employee_exits`, `templates`, `auth`, `users`.
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã API: versioned `v1` (REST –∏/–∏–ª–∏ gRPC + HTTP gateway).
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ë–î (PostgreSQL), –∫—ç—à/—Å–µ—Å—Å–∏–∏ (Redis), observability (Prometheus + logs).

### Frontend Web/Desktop (–µ–¥–∏–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞)

- –û–±—â–∏–π API-–∫–ª–∏–µ–Ω—Ç –∏ –µ–¥–∏–Ω—ã–µ query/mutation hooks.
- React UI –æ–¥–∏–Ω–∞–∫–æ–≤–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ web –∏ desktop.
- Desktop –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –æ–±–æ–ª–æ—á–∫–∞ –∏ OS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è).

---

## –≠—Ç–∞–ø—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### 1) Target Architecture & –≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (1 –Ω–µ–¥–µ–ª—è)

- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ backend = source of truth.
- –û–ø–∏—Å–∞—Ç—å, –∫–∞–∫–∏–µ IPC-–∫–∞–Ω–∞–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ OS-level).
- –£—Ç–≤–µ—Ä–¥–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ–∫—Ä—É–∂–µ–Ω–∏–π: local/staging/prod.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è frontend ‚Üî backend –∏ —Å–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π –∫ –º–∏–≥—Ä–∞—Ü–∏–∏.

### 2) API Contract First (1 –Ω–µ–¥–µ–ª—è)

- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã `v1` –¥–ª—è:
  - auth (login/refresh/logout/register);
  - requests + equipment_items;
  - employee_exits;
  - templates;
  - users.
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫, –ø–∞–≥–∏–Ω–∞—Ü–∏–∏, —Ñ–∏–ª—å—Ç—Ä–æ–≤, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∞–±–æ—Ç–∞—é—Ç backend –∏ –æ–±–∞ –∫–ª–∏–µ–Ω—Ç–∞.

### 3) –ü–µ—Ä–µ–Ω–æ—Å –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏–∑ Electron IPC –≤ backend (2‚Äì3 –Ω–µ–¥–µ–ª–∏)

- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ CRUD –∏ –ø—Ä–∞–≤–∏–ª–∞ –≤ backend-—Å–µ—Ä–≤–∏—Å—ã.
- –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—é, audit-–ø–æ–ª—è, idempotency where needed.
- –í–Ω–µ–¥—Ä–∏—Ç—å RBAC –Ω–∞ —É—Ä–æ–≤–Ω–µ backend.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ desktop main-process.

### 4) Auth & Session –º–æ–¥–µ–ª—å (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)

- JWT access + refresh rotation.
- –ï–¥–∏–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤.
- –î–ª—è web: cookie/CSRF/CORS —Å—Ç—Ä–∞—Ç–µ–≥–∏—è.
- –î–ª—è desktop: –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ refresh-—Ç–æ–∫–µ–Ω–∞.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –µ–¥–∏–Ω–∞—è –º–æ–¥–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è web –∏ desktop.

### 5) –ú–∏–≥—Ä–∞—Ü–∏—è web-–∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ backend API (1‚Äì2 –Ω–µ–¥–µ–ª–∏)

- –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ hooks –Ω–∞ backend API.
- –£–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ web –æ—Ç `window.electronAPI`.
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π UX –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ React Query.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è web-–≤–µ—Ä—Å–∏—è –±–µ–∑ Electron-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

### 6) –ú–∏–≥—Ä–∞—Ü–∏—è desktop-–∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ backend API (1 –Ω–µ–¥–µ–ª—è)

- –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ renderer desktop –Ω–∞ —Ç–æ—Ç –∂–µ API-–∫–ª–∏–µ–Ω—Ç, —á—Ç–æ –∏ web.
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å native-—Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ IPC (tray, notifications, backup dialogs).
- –õ–æ–∫–∞–ª—å–Ω—É—é SQLite –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ fallback/–∞—Ä—Ö–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** desktop –∏ web —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–∏–º backend.

### 7) –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö SQLite ‚Üí backend (1 –Ω–µ–¥–µ–ª—è)

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç –≤ backend (batch + retry + idempotency).
- –ü—Ä–æ–≥–Ω–∞—Ç—å –ø–∏–ª–æ—Ç–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å –∏ –º–∞—Å—Å–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é.
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ç—á—ë—Ç –ø–æ –æ—à–∏–±–∫–∞–º –∏ reconciliation.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –±–µ–∑ –ø–æ—Ç–µ—Ä—å.

### 8) Security/Observability/Operations (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)

- Rate limiting, structured logs, metrics, alerting.
- Backup/restore —É–∂–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ë–î.
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ runbook –∏ recovery —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–æ–Ω–Ω–æ –≥–æ—Ç–æ–≤–∞—è —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –º–æ–¥–µ–ª—å.

### 9) Rollout & deprecation –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ (1 –Ω–µ–¥–µ–ª—è)

- Feature flags, canary rollout.
- Dual-run –ø–µ—Ä–∏–æ–¥: —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ backend (–ª–æ–∫–∞–ª–∫–∞ —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback).
- –ü–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ ‚Äî deprecation –ª–æ–∫–∞–ª—å–Ω–æ–π SQLite-–º–æ–¥–µ–ª–∏.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ backend-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (Definition of Done)

- Web –∏ desktop –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω API –∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
- –í Electron IPC –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –∫—Ä–∏—Ç–∏—á–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –¥–æ–º–µ–Ω–∞.
- –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –∏–∑ SQLite –ø–æ–≤—Ç–æ—Ä—è–µ–º, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω.
- Auth/RBAC –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö.
- –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (backup/restore) –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã.

---

## –†–∏—Å–∫–∏ –∏ –º–µ—Ä—ã

- **–†–∏—Å–∫:** —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è UI –∏ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.  
  **–ú–µ—Ä–∞:** contract-first, –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–∞–Ω–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.

- **–†–∏—Å–∫:** –ø–æ—Ç–µ—Ä—è/–¥—É–±–ª–∏ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.  
  **–ú–µ—Ä–∞:** idempotent importer, dry-run, —Å–≤–µ—Ä–∫–∞ –∏—Ç–æ–≥–æ–≤.

- **–†–∏—Å–∫:** —Ä–µ–≥—Ä–µ—Å—Å desktop-—Ñ—É–Ω–∫—Ü–∏–π –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏.  
  **–ú–µ—Ä–∞:** —Å–æ—Ö—Ä–∞–Ω—è—Ç—å IPC —Ç–æ–ª—å–∫–æ –¥–ª—è OS-—Ñ–∏—á –∏ –ø–æ–∫—Ä—ã—Ç—å critical user flows —Ä—É—á–Ω—ã–º–∏ —Ç–µ—Å—Ç-–∫–µ–π—Å–∞–º–∏.

---

## –ü–æ—Ä—è–¥–æ–∫ —Å—Ç–∞—Ä—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–∏—Ç–µ—Ä–∞—Ü–∏—è 1)

1. –£—Ç–≤–µ—Ä–¥–∏—Ç—å API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã `v1` –ø–æ `requests`, `employee_exits`, `templates`.
2. –ü–æ–¥–Ω—è—Ç—å backend endpoints –ø–æ–¥ —ç—Ç–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏).
3. –°–¥–µ–ª–∞—Ç—å –µ–¥–∏–Ω—ã–π `apiClient` –≤ frontend –∏ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ web hooks.
4. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å desktop renderer –Ω–∞ —Ç–æ—Ç –∂–µ `apiClient`.
5. –ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö SQLite ‚Üí backend.

---

## –°—Ç–∞—Ç—É—Å

- –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2026-02-25.
- –í–µ—Ä—Å–∏—è –ø–ª–∞–Ω–∞: `v1`.
- –í–ª–∞–¥–µ–ª–µ—Ü –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞ (backend + frontend).
- Stage 1 (–≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏): [BACKEND_STAGE1_BOUNDARIES.md](./BACKEND_STAGE1_BOUNDARIES.md) ‚Äî ‚úÖ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ.
- Stage 2 (API –∫–æ–Ω—Ç—Ä–∞–∫—Ç `v1`): [BACKEND_STAGE2_API_CONTRACT_V1.md](./BACKEND_STAGE2_API_CONTRACT_V1.md) ‚Äî ‚úÖ —á–µ—Ä–Ω–æ–≤–∏–∫ –≥–æ—Ç–æ–≤.
