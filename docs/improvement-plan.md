# План развития Equipment Tracker

_Обновлено: 25 октября 2025_

## Методика приоритизации
- **P0 — быстрые победы (0–2 дня):** Небольшие изменения с высоким эффектом.
- **P1 — краткосрочные задачи (до 1 недели):** Требуют продуманной реализации, но ограничены по рискам.
- **P2 — среднесрочные инициативы (1–3 недели):** Существенно улучшают архитектуру и UX, задействуют несколько слоёв.
- **P3 — долгосрочное развитие (1+ месяц):** Стратегические улучшения, влияющие на продукт и процессы.

---

## P0 — быстрые победы
1. **Включить `PRAGMA foreign_keys` и индексы SQLite**  
   _Эффект:_ защищает от «висячих» данных, ускоряет запросы.
2. **Диалоги подтверждения удаления**  
   _Эффект:_ исключает случайные потери данных.
3. **Возврат карточек статистики выходов**  
   _Эффект:_ визуальная целостность дашборда.
4. **ESLint + Prettier конфигурация**  
   _Эффект:_ единый стиль кода, быстрый фидбек для команды.
5. **Документация по резервному копированию** (README/USAGE)  
   _Эффект:_ пользователи понимают сценарии бэкапа и восстановления.

## P1 — краткосрочные задачи
1. **Рефакторинг `electron/main.ts`** на модули: `db`, `windows`, `ipc/requests`, `ipc/exits`, `ipc/backup`.  
   _Эффект:_ легче сопровождать и тестировать, проще внедрять новые фичи.
2. **Единый слой валидации данных** (например, `zod`) в main-процессе и фронтенде.  
   _Эффект:_ защита от некорректных payload’ов, единые сообщения об ошибках.
3. **React Query (TanStack Query)** для запросов заявок и выходов.  
   _Эффект:_ автоматические refetch’и, кэш, optimistic updates.
4. **Переиспользуемые хуки `useRequests`, `useEmployeeExits`**.  
   _Эффект:_ разделение бизнес-логики и представления, меньше дублирования.
5. **Настройка Husky + lint-staged**.  
   _Эффект:_ гарантированно чистый код в репозитории.

## P2 — среднесрочные инициативы
1. **Механизм миграций БД** (таблица `migrations` или `user_version`).  
   _Эффект:_ пошаговые обновления схемы, контроль версий данных.
2. **Бизнес-логику в отдельные сервисы** (RequestsService, EmployeeExitsService).  
   _Эффект:_ тестируемость и изоляция SQL от IPC.
3. **Виртуализация таблиц** (React Virtual / TanStack Table) и расширенная фильтрация.  
   _Эффект:_ производительность при больших объёмах данных.
4. **Storybook/Ladle** для UI-компонентов.  
   _Эффект:_ изолированная отладка, единый каталог компонентов.
5. **Интеграционные тесты Electron** (Playwright/Spectron).  
   _Эффект:_ уверенность в работоспособности ключевых сценариев.

## P3 — долгосрочное развитие
1. **Автообновления через `electron-updater`** и канал релизов.  
   _Эффект:_ пользователи быстро получают фиксы и фичи.
2. **Асинхронные операции с БД** (worker_threads / отдельный процесс).  
   _Эффект:_ отсутствие блокировок main-процесса при тяжёлых запросах.
3. **Ролевые сценарии/аудит**: права доступа, журнал действий, экспорт отчётов.  
   _Эффект:_ соответствие корпоративным требованиям, прозрачность операций.
4. **Система сбора обратной связи** (лог-файлы, анонимные отчёты по согласию).  
   _Эффект:_ ускоренная диагностика и планирование roadmap.

---

## Дорожная карта внедрения
1. **Спринт «Стабильность и UX» (1 неделя)**  
   - Все задачи P0.  
   - Базовый рефакторинг `electron/main.ts` (структурные заготовки).  
   - Документация по резервному копированию.
2. **Спринт «Надёжный backend» (1–2 недели)**  
   - Завершить рефакторинг main-процесса.  
   - Добавить валидацию данных и сервисный слой.  
   - Внедрить React Query и хуки для фронтенда.  
   - Настроить Husky + lint-staged + CI.
3. **Спринт «Производительность и масштаб» (2–3 недели)**  
   - Запустить систему миграций.  
   - Реализовать виртуализацию таблиц и расширенные фильтры.  
   - Подготовить Storybook и интеграционные тесты.  
   - Продумать асинхронный доступ к БД.
4. **Спринт «Продвинутая поддержка» (3+ недели)**  
   - Автообновления и каналы релизов.  
   - Аудит, экспорт отчётов, права доступа.  
   - Сбор обратной связи и мониторинг.

---

## Метрики успеха
- **Надёжность:** отсутствие «висячих» строк, успешное прохождение тестов и миграций.
- **UX:** снижение количества случайных удалений, рост удовлетворённости пользователей по внутренним опросам.
- **Производительность:** время загрузки списков < 200 мс при 10k записей, стабильность FPS при прокрутке.
- **DX:** 0 предупреждений ESLint, 100% pre-commit хуков, покрытие тестами критичной логики.
- **Релизы:** время доставки фикса до пользователей < 1 недели, предсказуемая история изменений.

---

## Следующие шаги (актуально)
- [x] Включить `PRAGMA foreign_keys` и индексацию таблиц.  
- [x] Добавить confirm-диалоги перед удалением заявок и записей выходов.  
- [x] Вернуть и улучшить карточки статистики в разделе выходов сотрудников.  
- [x] Настроить ESLint + Prettier и добиться чистого `npm run lint`.  
- [x] Обновить документацию по резервному копированию и восстановлению.  
- [x] Подготовить модульную структуру для `electron/main.ts` (P1).  
- [x] Добавить слой валидации данных (например, `zod`) и унифицировать обработку ошибок (P1).  
- [x] Внедрить React Query и специализированные хуки для заявок и выходов (P1).  
- [ ] Настроить Husky + lint-staged + CI-пайплайн (P1).
